---
title: "Activités volcaniques mondiales au fil des ans"
author: "Erika Audet, Anne-Marie Groulx, Allisson Picard"
institute: "Université Laval"
date: "`r Sys.Date()`"
output:
  xaringan::moon_reader:
    css: xaringan-themer.css
    lib_dir: libs
    nature:
      ratio: "16:9"
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

```{r load-packages, include = FALSE}
# Ajoutez tous les packages supplémentaires dont vous avez besoin à ce chunk
install.packages("xaringanthemer", repos = "http://cran.us.r-project.org", dependencies = TRUE)
#install.packages("gganimate")
#install.packages("xaringanthemer", repos = "http://cran.us.r-project.org") - J'ai juste eu besoin de faire rouler ça une première fois, on peut retirer la ligne quand ça fonctionne pour toutes.
library(tidyverse)
library(palmerpenguins)
library(knitr)
library(xaringanthemer)
library(kableExtra)
library(readr)
library(ggplot2)
library(gganimate)
library(ggmap)
library(gapminder)
library(leaflet)

```

```{r setup, include=FALSE}
# Pour une meilleure résolution de figure
knitr::opts_chunk$set(fig.retina = 3, dpi = 300, fig.width = 6, fig.asp = 0.618, out.width = "80%", warning = FALSE, message = FALSE)
style_xaringan(
  title_slide_background_image = "img/volcan.png"
)
```

```{r load-data, include=FALSE}
# Charger vos données ici

#Chargement des tableaux
eruptions <- read_csv("../data/eruptions.csv")
events <- read_csv("../data/events.csv")
volcano <- read_csv("../data/volcano.csv")
#Création du jeu de donnée
volcan1<-merge(eruptions,events, by="eruption_number") #Jeu intermédiaire pour 1er merge
volcan<-merge(volcan1,volcano, by.x="volcano_number.x", by.y="volcano_number")
volcan<-volcan[, -c(8,9,12,13,16,17,18,21,23,24,25,31,32,37:40,42:45)]
colnames(volcan)[1] <- "volcano_number"
colnames(volcan)[3] <- "volcano_name"
colnames(volcan)[10] <- "latitude"
colnames(volcan)[11] <- "longitude"
volcan$last_eruption_year<-as.numeric(volcan$last_eruption_year)
volcan$minor_rock_1<-ifelse(volcan$minor_rock_1== unique(volcan$minor_rock_1)[3],NA,volcan$minor_rock_1)
remove(volcan1)#retarit du jeu intermédiaire

volcan_resume<-volcan[,c(3,15,20,16,25,17,18,19,5,7,9,4,6,8,13,14)]

#Animation:
geoanim<-data.frame(nom=volcan$volcano_name,
                    long=volcan$longitude,
                    lati=volcan$latitude, 
                    pays=volcan$country,
                    vei=volcan$vei,
                    pop=volcan$population_within_5_km,
                    annee=as.character(volcan$start_year))

geoanim<-unique(geoanim)
geoanim$annee<-as.integer(geoanim$annee)
geoanim$popquant<-ifelse(geoanim$pop<=6,25,
                         ifelse(geoanim$pop>=7&geoanim$pop<=328, 50,
                                ifelse(geoanim$pop>=329&geoanim$pop<=3006,75,100)))
geoanim$popquant<-as.factor(geoanim$popquant)
geoanim$popquant<-ordered(geoanim$popquant, c("25","50","75","100"))

#Pour la carte interactive
#Création d'un tableau contenant les infos que l'on veut afficher
tab_point <- data.frame(nom=volcan$volcano_name,long=volcan$longitude,lati=volcan$latitude, pays=volcan$country, derniere_erup=volcan$last_eruption_year, altitude=volcan$elevation)

#Retrait des doublons
tab_point <- unique(tab_point)

#Création de l'icône que l'on souhaite afficher
icone <- icons(iconUrl = "https://raw.githubusercontent.com/R-CoderDotCom/chinchet/main/inst/red.png",
               iconWidth = 50, iconHeight = 50)

```



class: center, middle

## Objectif : 
Aider l'utilisateur à se renseigner sur les volcans et les activités volcaniques dans le monde et lui permettre de prédire l'indice d'activité volcanique pour des caractéristiques choisies.

---

## Aperçu des données (choisir les variables + intéressantes ou celles du mod. prédictif):
```{r volcan-table, echo = FALSE}

kable(volcan_resume[c(1:10),], "html", row.names = FALSE) %>%
 kable_styling(bootstrap_options = "hover") %>%
 scroll_box(width = "100%", height = "400px")

```

---

class: inverse, center, middle

# Éléments de l'application shiny

---

# Carte animée
.pull-left[
Nous avons d'abord créé un ggplot qui utilise comme axes des x et des y les variables *longitudes* et *latitudes*. Puis, nous avons positionné sur la grille une carte du monde avec le package ggmap. Les coordonnées géographiques des éruptions y ont été placés. La couleur du point représente la force d'éruption, puis la grosseur du point représente la taille de la population vivant dans un rayon de 5km. Comme il aurait été étourdissant de représenter les 11200 éruptions sur cette carte, nous avons utiliser la variable *année d'éruption* pour animer les lieux d'éruption dans le temps. On a donc un *frame* d'animation pour représenter les éruptions sur environ 2 années. Voici un exemple d'un graphique statique pour l'année qui recense le plus d'éruptions, soit 2004.
]

.pull-right[
```{r ggplot2004, echo = FALSE}
cols<-colorRampPalette(c("yellow", "red"))
colsvei<-cols(8)

mapWorld <- borders("world", colour="palegreen3", fill="palegreen3")

mp1 <- ggplot(geoanim[geoanim$annee==2004,], aes(x=long, y=lati, colour=as.factor(vei), size=popquant)) + 
  theme(panel.background = element_rect(fill = 'lightskyblue1', colour = 'gray90'))+
  mapWorld + 
  geom_point(alpha=0.7)+
  scale_colour_manual(name="vei", values=colsvei)+
  theme(aspect.ratio=3/4)

mp1

```
]
---


# Carte animée 2

Voici maintenant un graphique statique qui regroupe toutes les éruptions de 1812 classées par indice de force:

```{r ggplot2004vei, echo = TRUE, eval=FALSE}
mp2 <- ggplot(geoanim[geoanim$anne==1812,], aes(x=long, y=lati, colour=as.factor(vei), size=popquant)) + 
  theme(panel.background = element_rect(fill = 'lightskyblue1', colour = 'gray90'))+
  mapWorld + 
  geom_point(alpha=0.7)+
  scale_colour_manual(name="vei", values=colsvei)+
  theme(aspect.ratio=3/4)+
  facet_wrap(~vei)

mp2

#Ajouter une image à la place, c'est long!!!

```

---
# Carte animée 3

Mettre un video à la place? trouver comment looper le gif?
Voici le gif résulant quand on anime par année (fonctionne juste dans un browser):

.center[![Carte animée](../ToutesAnnées.gif)]


---
# Carte interactive

Nous avons créer un jeu de données contenant les informations qui nous intéressent (latitude, longitude, nom du volcan, pays, année de la dernière éruption, altitude), tout en retirant les doublons. Avec le package leaflet, nous avons créer une carte du monde sur laquelle des punaises pour chaque volcan ont été placées. Sur l'application, l'utilisateur peut se déplacer sur la carte et cliquer sur une punaise pour avoir les informations correspondant au volcan sélectionné, soit son nom, le pays où il se trouve, son altitude et l'année de sa dernière éruption.

```{r out.width="100%",out.height="50%", echo=FALSE}
leaflet(options=leafletOptions(minZoom = 1, maxZoom = 18))%>% addTiles() %>% 
  addMarkers(data = data.frame(lng = tab_point$long, lat = tab_point$lati),
             popup = paste0("Nom du volcan: ",tab_point$nom, "<br>", "Pays: ",tab_point$pays, "<br>",
                            "Altitude: ",tab_point$altitude,"<br>","Année de la dernière activité volcanique: ",tab_point$derniere_erup),
             icon = icone)


```




---

class: inverse, middle, center

# Utiliser xaringan

---

# xaringan

- La présentation est créée à l'aide du package `xaringan`

- Utilisez `---` pour séparer les diapositives et `--` pour les versions incrémentielles

--

- Comme ça

---

# Dispositions

Vous pouvez utiliser du texte brut

- ou des listes

.pull-left[
ou texte sur deux colonnes $^*$
]
.pull-right[
- Comme
- ca
]

.footnote[
[*] Et ajouter des notes de bas de page
]
---

# Code

```{r boring-regression}
# une régression ennuyeuse
model <- lm(dist ~ speed, data = cars)
model
```

---

# Plots

```{r recode-species, echo = FALSE}
# Dans ce chunk, je fais un tas d'analyses que je ne veux pas présenter
# dans mes diapositives. Mais j'ai besoin du jeu de données résultant pour un tracé que je veux présenter.
iris_modified <- iris %>%
  mutate(Species = fct_other(Species, keep = "setosa"))
```

```{r plot-iris, echo = FALSE}
# Code caché avec echo = FALSE
# Utilise l'ensemble de données d'iris modifié du bloc précédent
# Jouez avec la hauteur et la largeur jusqu'à ce que vous soyez satisfait du look
ggplot(data = iris_modified, mapping = aes(x = Sepal.Width, y = Sepal.Length, color = Species)) +
  geom_point() + 
  theme_minimal() # theme options: https://ggplot2.tidyverse.org/reference/ggtheme.html
```

---

## Plot et texte

.pull-left[
- Du texte
- ici
]
.pull-right[
```{r warning=FALSE, out.width="100%", fig.width=4, echo=FALSE}
# voyez comment j'ai changé out.width et fig.width par défaut
# pour agrandir la figure
ggplot(penguins, aes(x = bill_length_mm, y = species, color = species)) +
  geom_boxplot() +
  theme_minimal()
```
]

---

# Les tables

Si vous souhaitez générer un tableau, assurez-vous qu'il est au format HTML (au lieu de Markdown ou d'autres formats), par exemple,

```{r iris-table, echo = FALSE}
kable(head(volcan), format = "html")
```

---

# Images

```{r castle, echo = FALSE, out.width = "60%", fig.align = "center", fig.cap = "Image credit: Photo by Jörg Angeli on Unsplash."}
include_graphics("https://images.unsplash.com/photo-1535448033526-c0e85c9e6968?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=1650&q=80")
```

Ou vous pouvez également inclure une image pleine page. Voir la diapositive suivante.

---

background-image: url(https://images.unsplash.com/photo-1535448033526-c0e85c9e6968?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=1650&q=80)

---

# Expressions mathématiques

Vous pouvez écrire des expressions mathématiques LaTeX à l'intérieur d'une paire de signes dollar, par ex. &#36;\alpha+\beta$ rend $\alpha+\beta$. Vous pouvez utiliser le style d'affichage avec des signes dollar doubles :

```
$$\bar{X}=\frac{1}{n}\sum_{i=1}^nX_i$$
```

$$\bar{X}=\frac{1}{n}\sum_{i=1}^nX_i$$

Limites:

1. Le code source d'une expression mathématique LaTeX doit être sur une seule ligne, à moins qu'il ne soit à l'intérieur d'une paire de signes dollar doubles, auquel cas le `$$` de départ doit apparaître au tout début d'une ligne, suivi immédiatement d'un caractère autre qu'un espace et la terminaison `$$` doit être à la fin d'une ligne, précédée d'un caractère autre qu'un espace ;

1. Il ne doit pas y avoir d'espaces après le `$` d'ouverture ou avant le `$` de fermeture.

1. Les mathématiques ne fonctionnent pas sur la diapositive de titre (voir [#61](https://github.com/yihui/xaringan/issues/61) pour une solution de contournement).

---

# Envie d'aventure ?

- Vous voulez en savoir plus sur `xaringan` ? Voir https://slides.yihui.name/xaringan/#1.

- Vous êtes invités à utiliser le style par défaut des diapositives. En fait, c'est ce que j'attends de la majorité d'entre vous. Vous vous différencierez par le contenu de votre présentation.

- Mais certains d'entre vous voudront peut-être jouer avec le style des diapositives. La librairie
`xaringanthemer` fournit des solutions pour cela : https://pkg.garrickadenbuie.com/xaringanthemer.

- Et si vous voulez plus de cloches et de sifflets, il y a aussi `xaringanExtra` : https://pkg.garrickadenbuie.com/xaringanExtra.
